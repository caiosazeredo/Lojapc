{% extends "base.html" %}

{% block title %}{{ pc.name }} - PixelCraft PC{% endblock %}

{% block content %}
<section class="product-detail">
    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="{{ url_for('index') }}">Início</a>
            <i class="fas fa-chevron-right"></i>
            <a href="{{ url_for('catalog') }}">PCs</a>
            <i class="fas fa-chevron-right"></i>
            <a href="{{ url_for('catalog', category=pc.category_name|lower) }}">{{ pc.category_name }}</a>
            <i class="fas fa-chevron-right"></i>
            <span>{{ pc.name }}</span>
        </nav>
        
        <div class="product-content">
            <!-- Gallery -->
            <div class="product-gallery">
                <div class="gallery-main">
                    <img src="{{ pc.main_image or '/static/img/placeholder.jpg' }}" alt="{{ pc.name }}" id="mainImage">
                    {% if pc.limited_edition %}
                    <span class="badge badge-limited">Limited Edition</span>
                    {% endif %}
                </div>
                <div class="gallery-thumbs">
                    <img src="{{ pc.main_image }}" onclick="changeImage(this.src)" class="active">
                    {% if pc.gallery %}
                        {% for img in pc.gallery|json_loads %}
                        <img src="{{ img }}" onclick="changeImage(this.src)">
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
            
            <!-- Info -->
            <div class="product-info">
                <span class="product-category" style="color: {{ pc.category_color }}">
                    {{ pc.category_name }}
                </span>
                <h1 class="product-name">{{ pc.name }}</h1>
                <p class="product-subtitle">{{ pc.subtitle }}</p>
                
                <div class="product-rating">
                    <div class="stars">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>
                    </div>
                    <span>4.5 ({{ reviews|length }} avaliações)</span>
                </div>
                
                <div class="product-price">
                    {% if pc.price_old %}
                    <span class="price-old">R$ {{ pc.price_old|currency }}</span>
                    <span class="discount">-{{ ((1 - pc.price/pc.price_old) * 100)|int }}%</span>
                    {% endif %}
                    <div class="price-main">
                        <span class="price">R$ {{ pc.price|currency }}</span>
                        <span class="price-pix">no PIX</span>
                    </div>
                    <div class="price-installments">
                        ou <strong>12x</strong> de <strong>R$ {{ (pc.price/12)|currency }}</strong> sem juros
                    </div>
                </div>
                
                <!-- Quick Specs -->
                <div class="quick-specs">
                    <div class="spec">
                        <i class="fas fa-microchip"></i>
                        <div>
                            <span>Processador</span>
                            <strong>{{ pc.processor }}</strong>
                        </div>
                    </div>
                    <div class="spec">
                        <i class="fas fa-tv"></i>
                        <div>
                            <span>Placa de Vídeo</span>
                            <strong>{{ pc.gpu }}</strong>
                        </div>
                    </div>
                    <div class="spec">
                        <i class="fas fa-memory"></i>
                        <div>
                            <span>Memória RAM</span>
                            <strong>{{ pc.ram }}</strong>
                        </div>
                    </div>
                    <div class="spec">
                        <i class="fas fa-hdd"></i>
                        <div>
                            <span>Armazenamento</span>
                            <strong>{{ pc.storage }}</strong>
                        </div>
                    </div>
                </div>
                
                <!-- Graffiti Info -->
                {% if pc.graffiti_artist %}
                <div class="graffiti-info">
                    <i class="fas fa-paint-brush"></i>
                    <div>
                        <span>Arte exclusiva por</span>
                        <strong>{{ pc.graffiti_artist }}</strong>
                        <p>Estilo: {{ pc.graffiti_style }}</p>
                    </div>
                </div>
                {% endif %}
                
                <!-- Actions -->
                <div class="product-actions">
                    <div class="quantity-selector">
                        <button onclick="decreaseQuantity()">-</button>
                        <input type="number" id="quantity" value="1" min="1">
                        <button onclick="increaseQuantity()">+</button>
                    </div>
                    <button class="btn btn-primary btn-lg" onclick="buyNow({{ pc.id }})">
                        <i class="fas fa-bolt"></i> Comprar Agora
                    </button>
                    <button class="btn btn-secondary btn-lg" onclick="addToCart({{ pc.id }})">
                        <i class="fas fa-shopping-cart"></i> Adicionar ao Carrinho
                    </button>
                </div>
                
                <!-- Delivery Info -->
                <div class="delivery-info">
                    <div class="delivery-option">
                        <i class="fas fa-truck"></i>
                        <div>
                            <strong>Entrega no Rio de Janeiro</strong>
                            <p>Receba em até 3 dias úteis</p>
                        </div>
                    </div>
                    <div class="delivery-option">
                        <i class="fas fa-tools"></i>
                        <div>
                            <strong>Configuração em domicílio</strong>
                            <p>+R$ {{ pc.setup_price|currency }} - Instalamos na sua casa</p>
                        </div>
                    </div>
                </div>
                
                <!-- Benefits -->
                <div class="product-benefits">
                    <div class="benefit">
                        <i class="fas fa-shield-alt"></i>
                        <span>2 anos de garantia</span>
                    </div>
                    <div class="benefit">
                        <i class="fas fa-award"></i>
                        <span>Qualidade certificada</span>
                    </div>
                    <div class="benefit">
                        <i class="fas fa-headset"></i>
                        <span>Suporte especializado</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="product-tabs">
            <div class="tabs-header">
                <button class="tab-btn active" onclick="showTab('specs')">
                    <i class="fas fa-list"></i> Especificações
                </button>
                <button class="tab-btn" onclick="showTab('games')">
                    <i class="fas fa-gamepad"></i> Jogos Compatíveis
                </button>
                <button class="tab-btn" onclick="showTab('reviews')">
                    <i class="fas fa-star"></i> Avaliações
                </button>
            </div>
            
            <div class="tabs-content">
                <!-- Specs Tab -->
                <div class="tab-pane active" id="specs-tab">
                    <div class="specs-grid">
                        <div class="spec-group">
                            <h3><i class="fas fa-microchip"></i> Processador</h3>
                            <p>{{ pc.processor }}</p>
                        </div>
                        <div class="spec-group">
                            <h3><i class="fas fa-tv"></i> Placa de Vídeo</h3>
                            <p>{{ pc.gpu }}</p>
                        </div>
                        <div class="spec-group">
                            <h3><i class="fas fa-memory"></i> Memória RAM</h3>
                            <p>{{ pc.ram }}</p>
                        </div>
                        <div class="spec-group">
                            <h3><i class="fas fa-hdd"></i> Armazenamento</h3>
                            <p>{{ pc.storage }}</p>
                        </div>
                        <div class="spec-group">
                            <h3><i class="fas fa-server"></i> Placa-mãe</h3>
                            <p>{{ pc.motherboard }}</p>
                        </div>
                        <div class="spec-group">
                            <h3><i class="fas fa-plug"></i> Fonte</h3>
                            <p>{{ pc.psu }}</p>
                        </div>
                        <div class="spec-group">
                            <h3><i class="fas fa-cube"></i> Gabinete</h3>
                            <p>{{ pc.case_model }}</p>
                        </div>
                        <div class="spec-group">
                            <h3><i class="fas fa-fan"></i> Refrigeração</h3>
                            <p>{{ pc.cooling }}</p>
                        </div>
                    </div>
                </div>
                
                <!-- Games Tab -->
                <div class="tab-pane" id="games-tab">
                    <div class="games-grid">
                        {% for game in games %}
                        <div class="game-item">
                            <img src="{{ game.image_url }}" alt="{{ game.name }}">
                            <div class="game-info">
                                <h4>{{ game.name }}</h4>
                                <div class="game-performance">
                                    <span class="performance-badge performance-{{ game.performance|lower }}">
                                        {{ game.performance }}
                                    </span>
                                    <span>{{ game.fps_avg }} FPS @ {{ game.resolution }}</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Reviews Tab -->
                <div class="tab-pane" id="reviews-tab">
                    <div class="reviews-summary">
                        <div class="rating-average">
                            <h2>4.5</h2>
                            <div class="stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                            </div>
                            <p>{{ reviews|length }} avaliações</p>
                        </div>
                    </div>
                    
                    <div class="reviews-list">
                        {% for review in reviews %}
                        <div class="review-item">
                            <div class="review-header">
                                <strong>{{ review.customer_name }}</strong>
                                <div class="review-stars">
                                    {% for i in range(review.rating) %}
                                    <i class="fas fa-star"></i>
                                    {% endfor %}
                                </div>
                            </div>
                            <h4>{{ review.title }}</h4>
                            <p>{{ review.comment }}</p>
                            {% if review.verified_purchase %}
                            <span class="verified"><i class="fas fa-check-circle"></i> Compra verificada</span>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Related Products -->
        {% if related %}
        <section class="related-products">
            <h2>PCs <span class="gradient-text">Relacionados</span></h2>
            <div class="pc-grid">
                {% for item in related %}
                <div class="pc-card">
                    <div class="pc-image">
                        <img src="{{ item.main_image or '/static/img/placeholder.jpg' }}" alt="{{ item.name }}">
                        <div class="pc-overlay">
                            <a href="{{ url_for('product_detail', slug=item.slug) }}" class="btn btn-white">
                                <i class="fas fa-eye"></i> Ver Detalhes
                            </a>
                        </div>
                    </div>
                    <div class="pc-info">
                        <h3 class="pc-name">{{ item.name }}</h3>
                        <div class="pc-price">
                            <span class="price">R$ {{ item.price|currency }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
function changeImage(src) {
    document.getElementById('mainImage').src = src;
    document.querySelectorAll('.gallery-thumbs img').forEach(img => {
        img.classList.remove('active');
    });
    event.target.classList.add('active');
}

function showTab(tab) {
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById(tab + '-tab').classList.add('active');
}

function increaseQuantity() {
    const input = document.getElementById('quantity');
    input.value = parseInt(input.value) + 1;
}

function decreaseQuantity() {
    const input = document.getElementById('quantity');
    if (parseInt(input.value) > 1) {
        input.value = parseInt(input.value) - 1;
    }
}

function buyNow(pcId) {
    addToCart(pcId);
    window.location.href = '/checkout';
}
</script>
{% endblock %}